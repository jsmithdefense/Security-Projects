<#
.SYNOPSIS
    This PowerShell script sets all enabled local user accounts to require password expiration by enabling the PasswordExpires flag via CIM/WMI.

.NOTES
    Author          : Julian Smith
    LinkedIn        : linkedin.com/in/jsmithsec/
    GitHub          : github.com/jsmithdefense
    Date Created    : 2026-02-21
    Last Modified   : 2026-02-21
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : 21156
    STIG-ID         : WN11-00-000090

.TESTED ON
    Date(s) Tested  : 2026-02-20
    Tested By       : Julian Smith
    Systems Tested  : vuln-machine
    PowerShell Ver. : 7

.USAGE

> Run "Computer Management".
> Navigate to System Tools >> Local Users and Groups >> Users.
> Double-click each active account.
> If "Password never expires" is selected for any account, this is a finding
> Run the following command

    Example syntax:
    PS C:\> .\STIG-ID-WN11-AU-000090.ps1
#>

# sets all enabled local user accounts to require password expiration by enabling the PasswordExpires flag via CIM
Get-CimInstance Win32_UserAccount -Filter "LocalAccount=True AND Disabled=False" |
ForEach-Object {
    Set-CimInstance -InputObject $_ -Property @{ PasswordExpires = $true }
}

# validate 
 Get-CimInstance Win32_UserAccount -Filter "LocalAccount=True" |
Select-Object Name, PasswordExpires 
